generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
}

model Document {
  id        String   @id @default(uuid())
  
  // Основная информация
  date      DateTime                    // Дата документа (когда сделан анализ/приём)
  type      String                      // Тип: "анализ", "узи", "консультация", "выписка", "исследование"
  title     String                      // Заголовок: "Биохимия крови", "КТ брюшной полости"
  
  // Где и кто
  doctor    String?                     // ФИО врача
  specialty String?                     // Специальность: "уролог", "онколог", "терапевт"
  clinic    String?                     // Медучреждение
  
  // Содержимое
  summary   String?  @db.Text           // AI-резюме (краткий пересказ)
  conclusion String? @db.Text           // Заключение врача (дословная цитата из документа)
  recommendations String[] @default([]) // Рекомендации врача (список задач для пациента)
  content   String?  @db.Text           // Полный текст/расшифровка
  
  // Файл
  fileUrl   String?                     // URL файла в Vercel Blob
  fileName  String?                     // Оригинальное имя файла
  fileType  String?                     // MIME тип: "application/pdf", "image/jpeg"
  
  // Структурированные данные
  tags      String[]                    // Теги: ["онкология", "ПСА", "простата"]
  keyValues Json?                       // Ключевые показатели: {"ПСА": "4.5 нг/мл", "гемоглобин": "130 г/л"}
  
  // Мета
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([date])
  @@index([type])
}

// Временное хранилище для группировки фото из Telegram media groups
model MediaGroupPending {
  id           String   @id @default(uuid())
  mediaGroupId String   // Telegram media_group_id
  chatId       BigInt   // Chat ID для ответа
  fileId       String   // Telegram file_id
  fileType     String   // MIME тип: image/jpeg, image/png
  receivedAt   DateTime @default(now())
  
  @@index([mediaGroupId])
}
